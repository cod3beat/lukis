define(["require","flight/component","data/with_canvas","fabric"],function(t){function e(){this.defaultAttrs({color:"#E74C3C",isPainting:!1,width:1,brush:{color:"#000000"}}),this.after("initialize",function(){this.on("click",this.onClick),this.on(document,"uiPaintButtonsClicked",this.onUiPaintButtonsClicked),this.on(document,"colorChanged",this.setBrushProperty)}),this.onUiPaintButtonsClicked=function(t,e){"pencil"!==e.clicked&&this.attr.isPainting&&this.onReleaseHandlerRequested()},this.onClick=function(){this.attr.isPainting=!0,this.trigger(document,"uiPaintButtonsClicked",{clicked:"pencil"}),this.on(this.attr.canvasEl,"releaseHandlersRequested",this.onReleaseHandlerRequested),this.on(document,"selectedBrushReady",this.onSelectedBrushReady),this.on(this.attr.canvasEl,"paintPreparationReady",this.onPaintPreparationReady),this.trigger(this.attr.canvasEl,"paintRequested")},this.onPaintPreparationReady=function(){this.attr.canvas.isDrawingMode=!0,this.trigger(document,"selectedBrushRequested")},this.onSelectedBrushReady=function(t,e){this.setBrush(t,e)},this.setBrush=function(t,e){this.attr.canvas.freeDrawingBrush=e.brush.create(this.attr.canvas),this.attr.canvas.freeDrawingBrush.color=this.attr.brush.color},this.setBrushProperty=function(t,e){this.attr.brush[e.key]=e[e.key],this.attr.canvas.freeDrawingBrush[e.key]=e[e.key]},this.onReleaseHandlerRequested=function(){this.off(this.attr.canvasEl,"paintPreparationReady"),this.off(this.attr.canvasEl,"releaseHandlersRequested"),this.off(document,"selectedBrushReady"),this.attr.canvas.isDrawingMode=!1,this.attr.isPainting=!1}}var i=t("flight/component"),n=t("data/with_canvas");return t("fabric"),i(e,n)});