define(["require","flight/component","fabric","flight/lib/advice","flight/lib/compose","mixins/with_canvas","outlinePainter/rect","text!templates/hiddenInputImage.html"],function(t){function e(){this.defaultAttrs({isPainting:!1,color:"#585858",imageInput:"#hidden-image-input"}),this.after("initialize",function(){this.$node.parent().append(a),this.on("click",this.onClick),this.on(document,"uiPaintButtonsClicked",this.onUiPaintButtonsClicked),$(this.attr.imageInput).change(this.onImageInputChange.bind(this))}),this.getOutlinePainter=function(){return s.init(this.attr.canvas,{color:this.attr.color})},this.onImageInputChange=function(t){this.attr.file=t.target.files[0],this.attr.canvas.cursor="crosshair",this.attr.outlinePainter=this.getOutlinePainter(),r.mixin(this.attr.outlinePainter,[n.withAdvice]),this.attr.outlinePainter.after("finish",function(){this.afterFinishCallback()}.bind(this)),this.trigger(this.attr.canvasEl,"paintRequested",{painter:this.attr.outlinePainter})},this.onUiPaintButtonsClicked=function(t,e){"image"!==e.clicked&&this.isPainting&&this.trigger(this.attr.canvasEl,"paintStopRequested")},this.onClick=function(){this.attr.isPainting=!0,this.trigger(document,"uiPaintButtonsClicked",{clicked:"image"}),this.loadImageSelectionDialog()},this.loadImageSelectionDialog=function(){$(this.attr.imageInput).click()},this.afterFinishCallback=function(){this.trigger(this.attr.canvasEl,"paintStopRequested"),this.attr.rect=this.attr.outlinePainter.outline,this.addImageToCanvas(),this.attr.canvas.cursor="default"},this.addImageToCanvas=function(){var e=this,i=this.attr.rect;t(["images/imageCanvasPlacement"],function(t){e.trigger(document,"loadingIndicatorRequested"),t.create(e.attr.canvas,{x:i.width>0?i.x:i.x+i.width,y:i.height>0?i.y:i.y+i.height,width:Math.abs(i.width),height:Math.abs(i.height),file:e.attr.file},function(){e.trigger(document,"hideLoadingIndicatorRequested")})}),this.attr.rect=null,this.attr.isPainting=!1}}var i=t("flight/component"),n=(t("fabric"),t("flight/lib/advice")),r=t("flight/lib/compose"),o=t("mixins/with_canvas"),s=t("outlinePainter/rect"),a=t("text!templates/hiddenInputImage.html");return i(e,o)});