define(["require","flight/component","data/with_canvas","fabric"],function(t){function e(){this.defaultAttrs({brush:{color:"#000000"}}),this.after("initialize",function(){this.on("click",this.onClick),this.on(document,"colorChanged",this.setBrushProperty)}),this.setInitHandlers=function(){this.on(document,"canvasMouseDown",this.onMouseDown),this.on(document,"releasHandlersRequested",this.releaseHandlers),this.on(document,"selectedBrushReady",this.setBrush)},this.setPaintHandlers=function(){this.on(document,"canvasMouseMove",this.onMouseMove),this.on(document,"canvasMouseUp",this.onMouseUp)},this.releaseInitHandlers=function(){this.off(document,"canvasMouseDown"),this.off(document,"releasHandlersRequested")},this.releasePaintHandlers=function(){this.off(document,"canvasMouseMove"),this.off(document,"canvasMouseUp")},this.onClick=function(){this.setInitHandlers(),this.attr.canvas.selection=!1,this.trigger(document,"paintRequested"),this.trigger(document,"selectedBrushRequested")},this.onMouseDown=function(t,e){var n=this.attr.canvas.getPointer(e.e);i={ox:n.x,oy:n.y,width:1,height:1},this.setPaintHandlers()},this.onMouseMove=function(t,e){var n=this.attr.canvas.getPointer(e.e);i.height=n.y-i.oy,i.width=n.x-i.ox,this.renderPaintOutline(i.ox,i.oy,i.width,i.height)},this.onMouseUp=function(){this.trigger(document,"paintStopRequested"),this.releaseHandlers(),this.attr.canvas.renderAll(),this.createShapeBrush()},this.renderPaintOutline=function(t,e,i,n){var r=this.attr.canvas.contextTop;r.save(),r.lineWidth=1,r.strokeStyle=this.attr.brush.color,r.strokeRect(t,e,i,n),r.restore()},this.createShapeBrush=function(){var e="shapeBrush/rect-"+this.attr.brushId,n=this;t([e],function(t){t.create(n.attr.canvas,{x:i.width>0?i.ox:i.ox+i.width,y:i.height>0?i.oy:i.oy+i.height,width:Math.abs(i.width),height:Math.abs(i.height),color:n.attr.brush.color}),i=null})},this.setBrushProperty=function(t,e){this.attr.brush[e.key]=e[e.key],this.attr.canvas.freeDrawingBrush[e.key]=e[e.key]},this.setBrush=function(t,e){this.attr.brushId=e.selectedId},this.releaseHandlers=function(){this.releaseInitHandlers(),this.releasePaintHandlers(),this.attr.canvas.clearContext(this.attr.canvas.contextTop),this.attr.canvas.selection=!0}}var i,n=t("flight/component"),r=t("data/with_canvas");return t("fabric"),n(e,r)});