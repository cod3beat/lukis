define(["require","flight/component","flight/lib/advice","flight/lib/compose","data/with_canvas","fabric","outlinePainter/rect"],function(t){function e(){this.defaultAttrs({brush:{color:"#000000"}}),this.after("initialize",function(){this.on("click",this.onClick),this.on(document,"uiBrushClicked",this.onUiBrushClicked),this.on(document,"colorChanged",this.setBrushProperty)}),this.onUiBrushClicked=function(t,e){"rect"!==e.clicked&&(console.log("rect stopped"),this.trigger(document,"paintStopRequested"))},this.afterFinishCallback=function(){this.trigger(document,"paintStopRequested"),this.attr.rect=this.attr.outlinePainter.outline,this.createShapeBrush()},this.setHandlers=function(){this.on(document,"selectedBrushReady",this.onSelectedBrushReady)},this.releaseHandlers=function(){this.off(document,"releaseHandlersRequested")},this.onClick=function(){this.trigger(document,"uiBrushClicked",{clicked:"rect"}),this.attr.outlinePainter=o.init(this.attr.canvas,{color:this.attr.brush.color}),r.mixin(this.attr.outlinePainter,[n.withAdvice]),this.attr.outlinePainter.after("finish",function(){this.afterFinishCallback()}.bind(this)),this.setHandlers(),this.trigger(document,"paintRequested",{painter:this.attr.outlinePainter}),this.trigger(document,"selectedBrushRequested")},this.createShapeBrush=function(){var e="shapeBrush/rect-"+this.attr.brushId,i=this,n=i.attr.rect;t([e],function(t){t.create(i.attr.canvas,{x:n.width>0?n.x:n.x+n.width,y:n.height>0?n.y:n.y+n.height,width:Math.abs(n.width),height:Math.abs(n.height),color:i.attr.brush.color}),i.attr.canvas.renderAll()}),i.attr.rect=null},this.onSelectedBrushReady=function(t,e){this.setBrush(t,e)},this.setBrushProperty=function(t,e){this.attr.brush[e.key]=e[e.key]},this.setBrush=function(t,e){this.attr.brushId=e.selectedId}}var i=t("flight/component"),n=t("flight/lib/advice"),r=t("flight/lib/compose"),s=t("data/with_canvas"),o=(t("fabric"),t("outlinePainter/rect"));return i(e,s)});