define(["require","flight/component","fabric"],function(t){function e(){this.after("initialize",function(){this.attr.canvas=new r.Canvas(this.$node.attr("id")),this.on(document,"canvasRequested",this.publishCanvas),this.on(document,"paintRequested",this.preparePainting),this.on(document,"releaseCanvasHandlers",this.releaseHandlers),this.on(document,"colorChanged",this.changeColor)}),this.publishCanvas=function(){this.trigger(document,"canvasReady",{canvas:this.attr.canvas})},this.preparePainting=function(){var t=this,e=this.attr.canvas;this.paintHandlers={onMouseDown:function(e){t.trigger(document,"canvasMouseDown",e)},onMouseUp:function(e){t.trigger(document,"canvasMouseUp",e)},onMouseMove:function(e){t.trigger(document,"canvasMouseMove",e)}},this.trigger(document,"paintPreparationReady",{canvas:e}),e.on("mouse:down",this.paintHandlers.onMouseDown),e.on("mouse:up",this.paintHandlers.onMouseUp),e.on("mouse:move",this.paintHandlers.onMouseMove),this.on(document,"keydown",this.onKeyDown),this.on(document,"paintStopRequested",this.releaseHandlers)},this.releaseHandlers=function(){var t=this.attr.canvas;t.off("mouse:down",this.paintHandlers.onMouseDown),t.off("mouse:up",this.paintHandlers.onMouseUp),t.off("mouse:move",this.paintHandlers.onMouseMove)},this.changeColor=function(t,e){var i=this.attr.canvas.getActiveObject();i&&("path"===i.type&&i.set("stroke",e.color),this.attr.canvas.renderAll())},this.onKeyDown=function(t){27===t.keyCode&&(this.releaseHandlers(),this.trigger(document,"releasHandlersRequested"))}}var i=t("flight/component"),r=t("fabric");return i(e)});