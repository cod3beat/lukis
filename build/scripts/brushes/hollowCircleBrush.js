define(["require","fabric","brushes/circleBrushHelper","flight/lib/compose","brushes/with_outline_helper"],function(e){var t=e("fabric"),i=e("brushes/circleBrushHelper"),r=e("flight/lib/compose"),n=e("brushes/with_outline_helper"),o=t.util.createClass(t.CircleBrush,{addPoint:function(e){var i=new t.Point(e.x,e.y),r=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return i.radius=r,i.strokeColor=n,this.points.push(i),i},onMouseMove:function(e){var t=this.addPoint(e),i=this.canvas.contextTop;i.lineWidth=1,i.strokeStyle=t.strokeColor,i.beginPath(),i.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),i.closePath(),i.stroke()},onMouseUp:function(){var e=this.canvas.renderOnAddition;this.canvas.renderOnAddition=!1;for(var i=0,r=this.points.length;r>i;i++){var n=this.points[i],o=new t.Circle({radius:n.radius,left:n.x,top:n.y,fill:null,stroke:n.strokeColor,strokeWidth:1});this.canvas.add(o)}this.canvas.clearContext(this.canvas.contextTop),this.removeShadowStyles(),this.canvas.renderOnAddition=e,this.canvas.renderAll()}}),a={create:function(e){return new o(e)},createShapeBrush:function(e,t){var r=this.create(e);r.width=t.brushWidth||10;var n=this.createOutline(r,t.shape,t),o=n.length;r.color=t.color||"#000000";for(var a=0;o>a;a++)r.addPoint(n[a]);i.drawCircles(e,{points:r.points})}};return r.mixin(a,[n]),a});