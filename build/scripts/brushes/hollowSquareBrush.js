define(["require","fabric","utils/rectOutlinePoints","utils/circleOutlinePoints","utils/lineOutlinePoints","brushes/squareBrushHelper"],function(t){var i=t("fabric"),e=t("utils/rectOutlinePoints"),n=t("utils/circleOutlinePoints"),r=t("utils/lineOutlinePoints"),o=t("brushes/squareBrushHelper"),s=i.util.createClass(i.BaseBrush,{width:10,addPoint:function(t){var e=new i.Point(t.x,t.y),n=i.util.getRandomInt(Math.ceil(this.width/2),this.width),r=new i.Color(this.color).setAlpha(i.util.getRandomInt(0,100)/100).toRgba();return e.width=e.height=n,e.strokeColor=r,this.points.push(e),e},initialize:function(t){this.canvas=t,this.points=[]},onMouseDown:function(){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this.setShadowStyles()},onMouseMove:function(t){var i=this.addPoint(t),e=this.canvas.contextTop;e.lineWidth=1,e.strokeStyle=i.strokeColor,e.beginPath(),e.strokeRect(i.x-i.width/2,i.y-i.height/2,i.width,i.height),e.stroke()},onMouseUp:function(){var t=this.canvas.renderOnAddition;this.canvas.renderOnAddition=!1;for(var e=0,n=this.points.length;n>e;e++){var r=this.points[e],o=new i.Rect({width:r.width,height:r.height,left:r.x,top:r.y,fill:null,stroke:r.strokeColor,strokeWidth:1});this.canvas.add(o)}this.canvas.clearContext(this.canvas.contextTop),this.removeShadowStyles(),this.canvas.renderOnAddition=t,this.canvas.renderAll()}});return{create:function(t){return new s(t)},createOutline:function(t,i,o){return"rect"===i?e(t,o.x,o.y,o.width,o.height):"circle"===i?n(t,o.x,o.y,o.radius):"line"===i?r(t,o.x1,o.y1,o.x2,o.y2):void 0},createShapeBrush:function(t,i){var e=this.create(t);e.width=i.brushWidth||10;var n=this.createOutline(e,i.shape,i),r=n.length;e.color=i.color||"#000000";for(var s=0;r>s;s++)e.addPoint(n[s]);o.drawSquares(t,{points:e.points})}}});