define(["require","fabric","brushes/squareBrushHelper","flight/lib/compose","mixins/with_outline_helper"],function(t){var i=t("fabric"),e=t("brushes/squareBrushHelper"),r=t("flight/lib/compose"),n=t("mixins/with_outline_helper"),o=i.util.createClass(i.BaseBrush,{width:10,addPoint:function(t){var e=new i.Point(t.x,t.y),r=i.util.getRandomInt(Math.ceil(this.width/2),this.width),n=new i.Color(this.color).setAlpha(i.util.getRandomInt(0,100)/100).toRgba();return e.width=e.height=r,e.strokeColor=n,this.points.push(e),e},initialize:function(t){this.canvas=t,this.points=[]},onMouseDown:function(){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this.setShadowStyles()},onMouseMove:function(t){var i=this.addPoint(t),e=this.canvas.contextTop;e.lineWidth=1,e.strokeStyle=i.strokeColor,e.beginPath(),e.strokeRect(i.x-i.width/2,i.y-i.height/2,i.width,i.height),e.stroke()},onMouseUp:function(){var t=this.canvas.renderOnAddition;this.canvas.renderOnAddition=!1;for(var e=0,r=this.points.length;r>e;e++){var n=this.points[e],o=new i.Rect({width:n.width,height:n.height,left:n.x,top:n.y,fill:null,stroke:n.strokeColor,strokeWidth:1});this.canvas.add(o)}this.canvas.clearContext(this.canvas.contextTop),this.removeShadowStyles(),this.canvas.renderOnAddition=t,this.canvas.renderAll()}}),a={create:function(t){return new o(t)},createShapeBrush:function(t,i){var r=this.create(t);r.width=i.brushWidth||10;var n=this.createOutline(r,i.shape,i),o=n.length;r.color=i.color||"#000000";for(var a=0;o>a;a++)r.addPoint(n[a]);e.drawSquares(t,{points:r.points})}};return r.mixin(a,[n]),a});