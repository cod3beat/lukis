define(["require","fabric","brushes/squareBrushHelper","flight/lib/compose","brushes/with_outline_helper"],function(t){var e=t("fabric"),i=t("brushes/squareBrushHelper"),r=t("flight/lib/compose"),n=t("brushes/with_outline_helper"),o=e.util.createClass(e.BaseBrush,{width:10,addPoint:function(t){var i=new e.Point(t.x,t.y),r=e.util.getRandomInt(Math.ceil(this.width/2),this.width),n=new e.Color(this.color).setAlpha(e.util.getRandomInt(0,100)/100).toRgba();return i.width=i.height=r,i.strokeColor=n,this.points.push(i),i},initialize:function(t){this.canvas=t,this.points=[]},onMouseDown:function(){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this.setShadowStyles()},onMouseMove:function(t){var e=this.addPoint(t),i=this.canvas.contextTop;i.lineWidth=1,i.strokeStyle=e.strokeColor,i.beginPath(),i.strokeRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height),i.stroke()},onMouseUp:function(){var t=this.canvas.renderOnAddition;this.canvas.renderOnAddition=!1;for(var i=0,r=this.points.length;r>i;i++){var n=this.points[i],o=new e.Rect({width:n.width,height:n.height,left:n.x,top:n.y,fill:null,stroke:n.strokeColor,strokeWidth:1});this.canvas.add(o)}this.canvas.clearContext(this.canvas.contextTop),this.removeShadowStyles(),this.canvas.renderOnAddition=t,this.canvas.renderAll()}}),a={create:function(t){return new o(t)},createShapeBrush:function(t,e){var r=this.create(t);r.width=e.brushWidth||10;var n=this.createOutline(r,e.shape,e),o=n.length;r.color=e.color||"#000000";for(var a=0;o>a;a++)r.addPoint(n[a]);i.drawSquares(t,{points:r.points})}};return r.mixin(a,[n]),a});