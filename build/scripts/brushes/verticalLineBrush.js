define(["require","fabric","flight/lib/compose","brushes/with_outline_helper"],function(e){var t=e("fabric"),r=e("flight/lib/compose"),i=e("brushes/with_outline_helper"),n=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var e=t.document.createElement("canvas");e.width=e.height=10;var r=e.getContext("2d");return r.strokeStyle=this.color,r.lineWidth=5,r.beginPath(),r.moveTo(5,0),r.lineTo(5,10),r.closePath(),r.stroke(),e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.getPatternSrc(),"repeat")},setBrushStyles:function(){this.callSuper("setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){var r=this.callSuper("createPath",e);return r.stroke=new t.Pattern({source:this.getPatternSrcFunction()}),r}}),o={create:function(e){var t=new n(e);return t},createShapeBrush:function(e,r){var i=this.create(e);i.width=r.brushWidth||10,i.color=r.color;for(var n=this.createOutline(i,r.shape,r),o=n.length-1;o>=0;o--)i._points.push(new t.Point(n[o].x,n[o].y));i._finalizeAndAddPath()}};return r.mixin(o,[i]),o});